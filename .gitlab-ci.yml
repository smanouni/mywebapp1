stages:
  - validate
  - compile
  - test
  - security
  - package
  - quality
  - deploy

validate:
  stage: validate
  image: node:latest
  before_script:
    - npm install -g htmlhint
  script:
    - htmlhint src/index.html || true

compile:
  stage: compile
  script:
    - echo "Pas de compilation nécessaire pour du HTML/CSS/JS"

test:
  stage: test
  image: node:latest
  before_script:
    - npm install -g stylelint stylelint-config-standard
  script:
    - stylelint "src/css/*.css"

security:
  stage: security
  before_script:
    - echo "Téléchargement et installation de ZAP"
    - curl -L -o ZAP.zip https://github.com/zaproxy/zaproxy/releases/latest/download/ZAP_2_15_0_Windows.zip
    - powershell -Command "Expand-Archive -Path ZAP.zip -DestinationPath C:\ZAP"
  script:
    - echo "Exécution de ZAP pour analyser l'application"
    - C:\ZAP\zap.bat -cmd -quickurl "http://localhost:8000" -quickout "zap_report.html"

package:
  stage: package
  script:
    - tar -cvf mywebapp.tar.gz src/
  artifacts:
    paths:
      - mywebapp.tar.gz

quality:
  stage: quality
  script:
    - echo "Contrôle qualité terminé"
deploy:
  stage: deploy
  script:
    - mkdir public
    - cp -r src/* public/
  artifacts:
    paths:
      - public
  only:
    - main
